// MBWay Payment - JavaScript com Timer

(function () {
    'use strict';

    // Timer de 5 minutos
    let timeLeft = 5 * 60; // 300 segundos
    const timerDisplay = document.getElementById('timer');

    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;

        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timeLeft <= 0) {
            // Timer expirado
            clearInterval(timerInterval);
            showExpired();
            return;
        }

        // Mudar cor quando estiver abaixo de 1 minuto
        if (timeLeft <= 60) {
            timerDisplay.style.color = '#DC2626';
        }

        timeLeft--;
    }

    // Iniciar timer
    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer();

    function showExpired() {
        const statusCard = document.querySelector('.status-card');
        statusCard.innerHTML = `
            <div class="status-icon" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
            </div>
            <h1 class="status-title">Tempo Expirado</h1>
            <p class="status-subtitle">O pedido de pagamento expirou. Por favor, gera um novo pedido.</p>
            <button onclick="window.location.href='./checkout.html'" style="
                margin-top: 20px;
                padding: 12px 24px;
                background: linear-gradient(135deg, #10B981, #059669);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
            ">Voltar ao Checkout</button>
        `;
    }

    // Simular confirmação de pagamento após 10 segundos (para teste)
    setTimeout(() => {
        clearInterval(timerInterval);
        showSuccess();
    }, 10000);

    function showSuccess() {
        const statusCard = document.querySelector('.status-card');
        statusCard.innerHTML = `
            <div class="status-icon" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <h1 class="status-title">Pagamento Confirmado!</h1>
            <p class="status-subtitle">Estás a ser redirecionado para o teu acesso...</p>
        `;

        // Guardar dados e redirecionar
        sessionStorage.setItem('accessGranted', 'true');
        setTimeout(() => {
            window.location.href = './direct.html';
        }, 2000);
    }

    // Capturar dados da URL
    const urlParams = new URLSearchParams(window.location.search);
    const phone = urlParams.get('phone');
    const amount = urlParams.get('amount') || '12,90€';

    console.log('MBWay Payment - Phone:', phone, 'Amount:', amount);
})();
